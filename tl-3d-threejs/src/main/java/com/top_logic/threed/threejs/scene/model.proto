package com.top_logic.threed.threejs.scene;

option NoInterfaces;
option NoXml;
option NoBinary;
option SharedGraph;

/** Base class for objects that can be rendered in a 3D context. */
abstract message Asset {

	/** Optional {@link ConnectionPoint} defining the point where this asset can be connected. */
	ConnectionPoint layoutPoint;
	
	/** Optional {@link ConnectionPoint}s defining points where other {@link Asset}s can be connected with its {@link Asset#layoutPoint}. */
	repeated ConnectionPoint snappingPoints;

}

/** A <tt>glTF</tt> artifact loaded from an URL. */
message GltfAsset extends Asset {

	/**
	 * The URL from which to retrieve <tt>glTF</tt> data.
	 * 
	 * <p>
	 * The URL is not used when a dynamic image is set.
	 * </p>
	 *
	 * @see #getDynamicImage()
	 */
	string url;

	/** 
	 * Dynamic image delivering the <tt>glTF</tt> data.
	 * 
	 * @see #getUrl()
	 */
	ImageData dynamicImage;
}

/** Holder object for retrieving dynamic <tt>glTF</tt> data. */
message ImageData {

	/**
	 * ID for this image. Multiple images with the same are ID are loaded once.
	 */
	string imageID;
	
	/**
	 * User object for this data.
	 */
	transient java.lang.Object userData;
	
	/**
	 * {@link com.top_logic.model.search.expr.query.QueryExecutor} computing the actual image data 
	 * from {@link #getUserData()}.
	 */
	transient com.top_logic.model.search.expr.query.QueryExecutor data;
	
}

/** A <tt>glTF</tt> artifact displaying a cube. */
message Cube extends Asset {
	/** Width of the cube. */
	float width;
	/** Height of the cube. */
	float height;
	/** Depth of the cube. */
	float depth;
}

/** Class defining a point in a {@link SceneNode} where other {@link ConnectionPoint}s can be connected. */
message ConnectionPoint {

	/** The {@link SceneNode} where this {@link ConnectionPoint} is a part of. */
	@Container
	Asset owner;

	/** Transformation where the connection point in its {@link SceneNode} lies. */
	repeated double transform;
	
	/** List of classifiers which defines which {@link ConnectionPoint}s can be connected. */
	repeated string classifiers;
}

/** Base class for a part in a {@link SceneGraph}. */
abstract message ScenePart {

	/** The {@link ScenePart} where this {@link ScenePart} is a part of. */
	@Container
	ScenePart parent;

}

/** Base class for a node in a {@link SceneGraph}. */
abstract message SceneNode extends ScenePart {
	/** Reference to a custom object that is represented by this scene node. */
	transient java.lang.Object userData;
	
	/** Whether this node can be selected on client side. If this node is not selectable, the first selectable 
	 * node in the parent hierarchy is selected instead. */
	boolean selectable;
	
	/** Transformation where this scene node lies. */
	repeated double transform;
	
	/** Whether this node must not be displayed. */
	boolean hidden;
	
	/** Optional color in RGB format to paint this node. */
	string color;
	
}

/** A collection of {@link SceneNode}s. */
message GroupNode extends SceneNode {
	/** The {@link SceneNode}s grouped together. */
	repeated SceneNode contents;
}

/** An atomic {@link SceneNode} displaying an {@link Asset}. */
message PartNode extends SceneNode {
	/** The {@link Asset} to display. */
	Asset asset;
}

/** The top-level object of a scene. */
message SceneGraph extends ScenePart {
	/** The top-level {@link SceneNode} of the scene. */
	SceneNode root;

	/** The currently selected {@link SceneNode}s. */
	@Ref
	repeated SceneNode selection;
	
	/** Transformation defining the coordinate system of the scene. */
	repeated double coordinateSystem;
	
	/** Step size to use when an element is rotated. */
	int rotateStepSize;

	/** Step size to use when an element is translated. */
	int translateStepSize;
	
	/** Number of floors in the scene. */
	int numberOfFloors;
	
}
